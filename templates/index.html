<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Homepage - local-booru</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="index-page-container">
        <h1>local-booru</h1>

		<nav>
			<a href="/upload">Upload</a>
			<a href="/gallery">Gallery</a>
			<a href="/batch_actions">Batch Actions</a>
			<a href="/tag_manager">Tag Manager</a>
			<a href="/saved_searches">Saved Searches</a>
			<a href="/help">Help</a>
		</nav>

        <form class="search-form-index" action="/gallery" method="get">
            <div class="autocomplete-container">
                <input
                    type="text"
                    name="q"
                    id="search-input"
                    placeholder="Search tags..."
                    autocomplete="off"
                    required
                />
                <div class="suggestions"></div>
            </div>
            <button type="submit">Search</button>
        </form>

        <div id="image-counter" class="image-counter"></div>
		<!-- Counter girls drawn by Kusaka Kokage -->
        <p>Serving {{ image_count }} images. local-booru {{ latest_version }}</p>
    </div>

    <script src="/static/js/autocomplete.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. DOM ELEMENT REFERENCES ---
            const searchInput = document.getElementById('search-input');
            const searchForm = document.querySelector('.search-form-index');
            const suggestionsBox = searchInput.nextElementSibling;
            const counterElement = document.getElementById('image-counter');

            // --- 2. CORE FUNCTIONS ---

            /**
             * Renders the animated image counter using individual digit images.
             * @param {number} count - The total number of images to display.
             */
            function displayImageCount(count) {
                if (!counterElement) return;

                counterElement.innerHTML = '';
                const countString = count.toString();
                
                for (const digit of countString) {
                    const img = document.createElement('img');
                    img.src = `/static/img/counter/image_${digit}.gif`;
                    img.alt = digit;
                    counterElement.appendChild(img);
                }
            }
            
            // --- 3. INITIALIZATION ---

            /**
             * Sets up the page by initializing the autocomplete, event listeners,
             * and the image counter.
             */
            function initialize() {
                // Set up the autocomplete for the main search bar, enabling saved searches.
                setupTagAutocomplete(searchInput, suggestionsBox, { showSavedSearches: true });

                // Add an event listener to the form to save the query on submission.
                searchForm.addEventListener('submit', () => {
                    const query = searchInput.value.trim();
                    if (query) {
                        addRecentSearch(query);
                    }
                });

                // Get the image count from the server-rendered template and display it.
                const imageCount = parseInt('{{ image_count }}', 10);
                displayImageCount(imageCount);
            }

            // --- 4. START THE APPLICATION ---
            initialize();
        });
    </script>
</body>
</html>